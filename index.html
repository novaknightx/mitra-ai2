<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mitra AI - Your Digital Farming Companion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            min-height: 100vh;
            color: #333;
            transition: background 0.3s ease, color 0.3s ease;
        }
        body.dark-mode {
            background: linear-gradient(135deg, #1B5E20, #33691E);
            color: #EEE;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: background 0.3s ease;
        }
        body.dark-mode .container {
            background: #121212;
        }
        .header {
            background: linear-gradient(135deg, #2E7D32, #4CAF50);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            transition: background 0.3s ease;
        }
        body.dark-mode .header {
            background: linear-gradient(135deg, #1B5E20, #33691E);
        }
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
            font-weight: 600;
        }
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        .team-credits {
            font-size: 11px;
            opacity: 0.8;
            margin-top: 8px;
            font-style: italic;
        }
        .language-selector {
            position: absolute;
            top: 15px;
            right: 15px;
        }
        .language-selector select {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
        }
        .dark-mode-toggle {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
        }
        .voice-section {
            padding: 30px 20px;
            text-align: center;
            background: linear-gradient(135deg, #E8F5E8, #F1F8E9);
            transition: background 0.3s ease;
        }
        body.dark-mode .voice-section {
            background: linear-gradient(135deg, #263238, #37474F);
        }
        .voice-button {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
        }
        body.dark-mode .voice-button {
            background: linear-gradient(135deg, #388E3C, #66BB6A);
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
        }
        .voice-button:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.4);
        }
        body.dark-mode .voice-button:hover {
            box-shadow: 0 10px 25px rgba(0,0,0,0.6);
        }
        .voice-button.listening {
            animation: pulse 1.5s infinite;
            background: linear-gradient(135deg, #FF5722, #FF7043);
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .voice-status {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
            transition: color 0.3s ease;
        }
        body.dark-mode .voice-status {
            color: #BBB;
        }
        .quick-actions {
            padding: 20px;
        }
        .quick-actions h3 {
            color: #2E7D32;
            margin-bottom: 15px;
            font-size: 18px;
            transition: color 0.3s ease;
        }
        body.dark-mode .quick-actions h3 {
            color: #81C784;
        }
        .action-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        .action-card {
            background: white;
            border: 2px solid #E8F5E8;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        body.dark-mode .action-card {
            background: #1E1E1E;
            border-color: #333;
            box-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }
        .action-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.2);
            border-color: #4CAF50;
        }
        body.dark-mode .action-card:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.6);
            border-color: #81C784;
        }
        .action-card .icon {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }
        .action-card h4 {
            color: #2E7D32;
            font-size: 14px;
            margin-bottom: 5px;
            transition: color 0.3s ease;
        }
        body.dark-mode .action-card h4 {
            color: #81C784;
        }
        .action-card p {
            color: #666;
            font-size: 12px;
            line-height: 1.3;
            transition: color 0.3s ease;
        }
        body.dark-mode .action-card p {
            color: #BBB;
        }
        .chat-section {
            padding: 20px;
            background: #f9f9f9;
            display: none;
            transition: background 0.3s ease;
        }
        body.dark-mode .chat-section {
            background: #1E1E1E;
        }
        .chat-messages {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        .message {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: background 0.3s ease;
        }
        body.dark-mode .message {
            background: #333;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        .message.ai {
            background: linear-gradient(135deg, #E8F5E8, #F1F8E9);
            border-left: 4px solid #4CAF50;
            transition: background 0.3s ease, border-color 0.3s ease;
        }
        body.dark-mode .message.ai {
            background: linear-gradient(135deg, #263238, #37474F);
            border-left-color: #81C784;
        }
        .message.user {
            background: #2196F3;
            color: white;
            margin-left: 20px;
        }
        body.dark-mode .message.user {
            background: #1976D2;
        }
        .image-upload {
            padding: 20px;
            background: #f5f5f5;
            text-align: center;
            display: none;
            transition: background 0.3s ease;
        }
        body.dark-mode .image-upload {
            background: #1E1E1E;
        }
        .upload-area {
            border: 2px dashed #4CAF50;
            border-radius: 12px;
            padding: 40px 20px;
            cursor: pointer;
            transition: all 0.3s ease, border-color 0.3s ease;
        }
        body.dark-mode .upload-area {
            border-color: #81C784;
        }
        .upload-area:hover {
            background: #E8F5E8;
        }
        body.dark-mode .upload-area:hover {
            background: #263238;
        }
        .upload-area input {
            display: none;
        }
        .weather-widget, .price-widget {
            background: white;
            margin: 20px;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }
        body.dark-mode .weather-widget, body.dark-mode .price-widget {
            background: #1E1E1E;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        .weather-widget h3, .price-widget h3 {
            color: #2E7D32;
            margin-bottom: 10px;
            font-size: 16px;
            transition: color 0.3s ease;
        }
        body.dark-mode .weather-widget h3, body.dark-mode .price-widget h3 {
            color: #81C784;
        }
        .weather-info, .price-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .temp {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
            transition: color 0.3s ease;
        }
        body.dark-mode .temp {
            color: #81C784;
        }
        .price {
            font-size: 18px;
            font-weight: bold;
            color: #FF9800;
            transition: color 0.3s ease;
        }
        body.dark-mode .price {
            color: #FFB74D;
        }
        .forecast-card {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s ease;
        }
        body.dark-mode .forecast-card {
            background: #1E1E1E;
            border-left-color: #81C784;
        }
        .forecast-card.rain-alert {
            border-left-color: #FF9800;
            background: #FFF8E1;
        }
        body.dark-mode .forecast-card.rain-alert {
            background: #2E2620;
        }
        .forecast-day {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .forecast-condition {
            color: #666;
            font-size: 14px;
        }
        body.dark-mode .forecast-condition {
            color: #BBB;
        }
        .forecast-alert {
            color: #FF9800;
            font-size: 12px;
            margin-top: 5px;
        }
        .forecast-weather {
            text-align: right;
        }
        .forecast-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }
        .forecast-temp {
            font-size: 18px;
            font-weight: bold;
            color: #4CAF50;
        }
        body.dark-mode .forecast-temp {
            color: #81C784;
        }
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 400px;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }
        body.dark-mode .bottom-nav {
            background: #121212;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.5);
        }
        .nav-item {
            text-align: center;
            cursor: pointer;
            padding: 5px;
            border-radius: 8px;
            transition: all 0.3s ease;
            flex: 1;
        }
        .nav-item:hover {
            background: #E8F5E8;
        }
        body.dark-mode .nav-item:hover {
            background: #263238;
        }
        .nav-item.active {
            background: #4CAF50;
            color: white;
        }
        body.dark-mode .nav-item.active {
            background: #388E3C;
        }
        .nav-item .icon {
            font-size: 20px;
            margin-bottom: 2px;
        }
        .nav-item .label {
            font-size: 10px;
        }
        .hidden {
            display: none;
        }
        .visible {
            display: block;
        }
        @media (max-width: 400px) {
            .container {
                max-width: 100%;
            }
            .bottom-nav {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="dark-mode-toggle" id="darkModeToggle">🌙 Dark Mode</button>
            <div class="language-selector">
                <select id="languageSelect">
                    <option value="en">English</option>
                    <option value="hi">हिंदी</option>
                    <option value="te">తెలుగు</option>
                    <option value="mr">मराठी</option>
                    <option value="ta">தமிழ்</option>
                </select>
            </div>
            <h1>🌾 Mitra AI</h1>
            <p id="headerSubtitle">Your Digital Farming Companion</p>
            <div class="team-credits" id="teamCredits">Made by Team Codestrom</div>
        </div>
        <!-- Main Dashboard -->
        <div id="dashboard" class="section">
            <div class="voice-section">
                <button class="voice-button" id="voiceButton">
                    🎤<br>Tap to Speak
                </button>
                <div class="voice-status" id="voiceStatus">Say "Hi Mitra" to get started</div>
            </div>
            <div class="quick-actions">
                <h3 id="quickActionsTitle">Quick Actions</h3>
                <div class="action-grid">
                    <div class="action-card" onclick="showSection('chat', event)" data-section="chat">
                        <span class="icon">🌱</span>
                        <h4 id="cropAdviceTitle">Crop Advice</h4>
                        <p id="cropAdviceDesc">Get personalized crop recommendations</p>
                    </div>
                    <div class="action-card" onclick="showSection('disease', event)" data-section="disease">
                        <span class="icon">🔍</span>
                        <h4 id="diseaseDetectionTitle">Disease Detection</h4>
                        <p id="diseaseDetectionDesc">Upload plant photos for diagnosis</p>
                    </div>
                    <div class="action-card" onclick="showSection('weather', event)" data-section="weather">
                        <span class="icon">🌤️</span>
                        <h4 id="weatherTitle">Weather</h4>
                        <p id="weatherDesc">Local weather forecasts & alerts</p>
                    </div>
                    <div class="action-card" onclick="showSection('market', event)" data-section="market">
                        <span class="icon">💰</span>
                        <h4 id="marketTitle">Market Prices</h4>
                        <p id="marketDesc">Real-time mandi prices</p>
                    </div>
                </div>
            </div>
            <div class="weather-widget">
                <h3 id="currentWeatherTitle">Today's Weather</h3>
                <div class="weather-info">
                    <div>
                        <div class="temp">28°C</div>
                        <div>Partly Cloudy</div>
                    </div>
                    <div>
                        <div>💧 65% Humidity</div>
                        <div>💨 12 km/h Wind</div>
                    </div>
                </div>
            </div>
            <div class="price-widget">
                <h3 id="marketPricesTitle">Market Prices</h3>
                <div class="price-info">
                    <div>
                        <div>🍅 Tomato</div>
                        <div>🌾 Wheat</div>
                    </div>
                    <div>
                        <div class="price">₹28/kg</div>
                        <div class="price">₹2200/qtl</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Disease Detection Section -->
        <div id="disease" class="section hidden">
            <div class="image-upload" style="display: block;">
                <h3 id="diseaseUploadTitle">Plant Disease Detection</h3>
                <div class="upload-area" onclick="document.getElementById('imageInput').click()">
                    <input type="file" id="imageInput" accept="image/*" onchange="handleImageUpload(event)">
                    <div style="font-size: 48px; margin-bottom: 15px;">📷</div>
                    <p id="uploadInstruction">Tap to upload plant photo</p>
                    <p style="font-size: 12px; color: #666; margin-top: 10px;">Supports common Telangana crops: Rice, Cotton, Tomato, Chilli</p>
                </div>
            </div>
            <div class="chat-section" id="diseaseResults" style="display:none;">
                <h3>Analysis Results</h3>
                <div class="chat-messages" id="diseaseMessages"></div>
                <button onclick="resetDiseaseDetection()" style="background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-top: 10px;">
                    Upload Another Photo
                </button>
            </div>
        </div>
        <!-- Chat Section -->
        <div id="chat" class="section hidden">
            <div class="chat-section" style="display:block;">
                <h3 id="chatTitle">Chat with Mitra</h3>
                <div class="chat-messages" id="chatMessages"></div>
                <button class="voice-button" style="width:60px; height:60px; font-size:14px;" onclick="startVoiceChat()">
                    🎤
                </button>
            </div>
        </div>
        <!-- Weather Section -->
        <div id="weather" class="section hidden">
            <div style="padding: 20px;">
                <h3 id="weatherForecastTitle">7-Day Weather Forecast</h3>
                <div id="weatherForecast"></div>
            </div>
        </div>
        <!-- Market Section -->
        <div id="market" class="section hidden">
            <div style="padding: 20px;">
                <h3 id="marketDetailsTitle">Market Information</h3>
                <div id="marketDetails"></div>
            </div>
        </div>
        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="showSection('dashboard', event)">
                <div class="icon">🏠</div>
                <div class="label" id="homeLabel">Home</div>
            </div>
            <div class="nav-item" onclick="showSection('chat', event)">
                <div class="icon">💬</div>
                <div class="label" id="chatLabel">Chat</div>
            </div>
            <div class="nav-item" onclick="showSection('weather', event)">
                <div class="icon">🌤️</div>
                <div class="label" id="weatherLabel">Weather</div>
            </div>
            <div class="nav-item" onclick="showSection('market', event)">
                <div class="icon">💰</div>
                <div class="label" id="marketLabel">Market</div>
            </div>
        </div>
    </div>
    <script>
        let currentLanguage = 'en';
        let isListening = false;
        let recognition;
        let userLocation = null;
        let weatherData = null;
        let isDarkMode = false;
        
        // Language translations
        const translations = {
            en: {
                headerSubtitle: "Your Digital Farming Companion",
                teamCredits: "Made by Team Codestrom",
                quickActionsTitle: "Quick Actions",
                cropAdviceTitle: "Crop Advice",
                cropAdviceDesc: "Get personalized crop recommendations",
                diseaseDetectionTitle: "Disease Detection",
                diseaseDetectionDesc: "Upload plant photos for diagnosis",
                weatherTitle: "Weather",
                weatherDesc: "Local weather forecasts & alerts",
                marketTitle: "Market Prices",
                marketDesc: "Real-time mandi prices",
                currentWeatherTitle: "Today's Weather",
                marketPricesTitle: "Market Prices",
                diseaseUploadTitle: "Plant Disease Detection",
                uploadInstruction: "Tap to upload plant photo",
                chatTitle: "Chat with Mitra",
                weatherForecastTitle: "7-Day Weather Forecast",
                marketDetailsTitle: "Market Information",
                homeLabel: "Home",
                chatLabel: "Chat",
                weatherLabel: "Weather",
                marketLabel: "Market"
            },
            hi: {
                headerSubtitle: "आपका डिजिटल खेती साथी",
                teamCredits: "टीम कोडेस्ट्रॉम द्वारा निर्मित",
                quickActionsTitle: "त्वरित कार्य",
                cropAdviceTitle: "फसल सलाह",
                cropAdviceDesc: "व्यक्तिगत फसल सुझाव प्राप्त करें",
                diseaseDetectionTitle: "रोग पहचान",
                diseaseDetectionDesc: "निदान के लिए पौधों की तस्वीरें अपलोड करें",
                weatherTitle: "मौसम",
                weatherDesc: "स्थानीय मौसम पूर्वानुमान और अलर्ट",
                marketTitle: "बाज़ार भाव",
                marketDesc: "वास्तविक समय मंडी मूल्य",
                currentWeatherTitle: "आज का मौसम",
                marketPricesTitle: "बाज़ार भाव",
                diseaseUploadTitle: "पौधे की बीमारी की पहचान",
                uploadInstruction: "पौधे की तस्वीर अपलोड करने के लिए टैप करें",
                chatTitle: "मित्रा से बात करें",
                weatherForecastTitle: "7-दिन मौसम पूर्वानुमान",
                marketDetailsTitle: "बाज़ार जानकारी",
                homeLabel: "होम",
                chatLabel: "चैट",
                weatherLabel: "मौसम",
                marketLabel: "मार्केट"
            },
            te: {
                headerSubtitle: "మీ డిజిటల్ వ్యవసాయ సహాయకుడు",
                teamCredits: "టీమ్ కోడేస్ట్రామ్ చేత తయారు చేయబడింది",
                quickActionsTitle: "త్వరిత చర్యలు",
                cropAdviceTitle: "పంట సలహా",
                cropAdviceDesc: "వ్యక్తిగతీకరించిన పంట సిఫార్సులు పొందండి",
                diseaseDetectionTitle: "వ్యాధి గుర్తింపు",
                diseaseDetectionDesc: "నిర్ధారణ కోసం మొక్కల ఫోటోలను అప్‌లోడ్ చేయండి",
                weatherTitle: "వాతావరణం",
                weatherDesc: "స్థానీయ వాతావరణ అంచనాలు & హెచ్చరికలు",
                marketTitle: "మార్కెట్ ధరలు",
                marketDesc: "రియల్ టైమ్ మండి ధరలు",
                currentWeatherTitle: "నేటి వాతావరణం",
                marketPricesTitle: "మార్కెట్ ధరలు",
                diseaseUploadTitle: "మొక్కల వ్యాధి గుర్తింపు",
                uploadInstruction: "మొక్కల ఫోటో అప్‌లోడ్ చేయడానికి ట్యాప్ చేయండి",
                chatTitle: "మిత్రాతో చాట్ చేయండి",
                weatherForecastTitle: "7-రోజుల వాతావరణ అంచనా",
                marketDetailsTitle: "మార్కెట్ సమాచారం",
                homeLabel: "హోమ్",
                chatLabel: "చాట్",
                weatherLabel: "వాతావరణం",
                marketLabel: "మార్కెట్"
            },
            mr: {
                headerSubtitle:"तुमचा डिजिटल शेतीचा साथीदार",
                teamCredits: "टीम कोडेस्ट्रॉमद्वारे निर्मित",
                quickActionsTitle:"जलद क्रिया",
                cropAdviceTitle:"पीक सल्ला",
                cropAdviceDesc:"वैयक्तिकृत पीक शिफारसी मिळवा",
                diseaseDetectionTitle:"रोग शोधणे",
                diseaseDetectionDesc:"निदानासाठी वनस्पतींचे फोटो अपलोड करा",
                weatherTitle:"हवामान",
                weatherDesc:"स्थानिक हवामान अंदाज आणि सूचना",
                marketTitle:"बाजारभाव",
                marketDesc:"रिअल-टाइम मंडी किमती",
                currentWeatherTitle:"आजचे हवामान",
                marketPricesTitle:"बाजारभाव",
                diseaseUploadTitle:"वनस्पती रोग ओळख",
                uploadInstruction:"रोपाचा फोटो अपलोड करण्यासाठी टॅप करा",
                chatTitle:"मित्राशी गप्पा मारा",
                weatherForecastTitle:"७ दिवसांचा हवामान अंदाज",
                marketDetailsTitle:"बाजार माहिती",
                homeLabel:"घर",
                chatLabel:"गप्पा",
                weatherLabel:"हवामान",
                marketLabel:"बाजार"
            },
            ta: {
                headerSubtitle: "உங்கள் டிஜிட்டல் விவசாய துணை",
                teamCredits: "டீம் கோடெஸ்ட்ரோம் மூலம் உருவாக்கப்பட்டது",
                quickActionsTitle: "விரைவான செயல்கள்",
                cropAdviceTitle: "பயிர் ஆலோசனை",
                cropAdviceDesc: "தனிப்பயனாக்கிய பயிர் பரிந்துரைகள் பெறவும்",
                diseaseDetectionTitle: "நோய் கண்டறிதல்",
                diseaseDetectionDesc: "நோய் கண்டறிய தாவர புகைப்படங்களை பதிவேற்றவும்",
                weatherTitle: "வானிலை",
                weatherDesc: "உள்ளூர் வானிலை முன்னறிவிப்பு மற்றும் எச்சரிக்கைகள்",
                marketTitle: "சந்தை விலைகள்",
                marketDesc: "நேரலை மண்டி விலைகள்",
                currentWeatherTitle: "இன்றைய வானிலை",
                marketPricesTitle: "சந்தை விலைகள்",
                diseaseUploadTitle: "தாவர நோய் கண்டறிதல்",
                uploadInstruction: "தாவர புகைப்படத்தை பதிவேற்ற தட்டவும்",
                chatTitle: "மித்ராவுடன் அரட்டை",
                weatherForecastTitle: "7 நாள் வானிலை முன்னறிவிப்பு",
                marketDetailsTitle: "சந்தை தகவல்",
                homeLabel: "முகப்பு",
                chatLabel: "அரட்டை",
                weatherLabel: "வானிலை",
                marketLabel: "சந்தை"
            },
        };
        
        // Initialize app
        function initApp() {
            updateLanguage();
            initSpeechRecognition();
            getUserLocation();
            loadWeatherForecast();
            loadMarketDetails();
            toggleDarkMode(); // Initialize dark mode state
        }
        
        // Toggle dark mode
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            const toggleButton = document.getElementById('darkModeToggle');
            toggleButton.textContent = isDarkMode ? '☀️ Light Mode' : '🌙 Dark Mode';
        }
        
        // Get user's current location - Fixed for Telangana default
        function getUserLocation() {
            // Set default location to Telangana (using Hyderabad coordinates)
            userLocation = { 
                lat: 17.385044, 
                lng: 78.486671,
                city: "Hyderabad",
                state: "Telangana"
            };
            
            document.getElementById('voiceStatus').textContent = 'Loading data for Telangana...';
            loadLiveWeatherData();
            loadLiveMarketData();
            
            // Optional: Still try to get actual location but don't wait for it
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        // Update location if user allows, but don't break if denied
                        userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            city: "Your Location",
                            state: "Telangana"
                        };
                        console.log('Updated to user location:', userLocation);
                    },
                    function(error) {
                        console.log('Using default Telangana location');
                    },
                    { timeout: 5000, maximumAge: 300000 }
                );
            }
        }
        
        // Update the getCityName function to return Telangana cities
        async function getCityName(lat, lng) {
            const telanganaCities = ['Hyderabad', 'Warangal', 'Nizamabad', 'Karimnagar', 'Khammam'];
            return telanganaCities[Math.floor(Math.random() * telanganaCities.length)];
        }
        
        // Load live weather data - Updated for Telangana
        async function loadLiveWeatherData() {
            try {
                // Mock weather data realistic for Telangana climate
                const mockWeatherData = {
                    main: {
                        temp: Math.round(25 + Math.random() * 8), // 25-33°C typical for Telangana
                        humidity: Math.round(60 + Math.random() * 25), // 60-85% humidity
                        feels_like: Math.round(28 + Math.random() * 8)
                    },
                    weather: [
                        {
                            main: ['Clear', 'Partly Cloudy', 'Hot'][Math.floor(Math.random() * 3)],
                            description: 'Typical Telangana weather'
                        }
                    ],
                    wind: {
                        speed: Math.round(8 + Math.random() * 7) // 8-15 km/h typical
                    },
                    name: userLocation.city || 'Hyderabad'
                };
                
                weatherData = mockWeatherData;
                updateCurrentWeather();
                document.getElementById('voiceStatus').textContent = `Weather loaded for ${weatherData.name}, Telangana`;
                
                setTimeout(() => {
                    document.getElementById('voiceStatus').textContent = 'Say "Hi Mitra" to get started';
                }, 2000);
            } catch (error) {
                console.error('Weather data error:', error);
                document.getElementById('voiceStatus').textContent = 'Using default weather data';
            }
        }
        
        // Get city name from coordinates
        // async function getCityName(lat, lng) {
        //     // In a real app, you'd use reverse geocoding API
        //     // For now, we'll return a simulated city name
        //     const cities = ['Hyderabad', 'Mumbai', 'Delhi', 'Bangalore', 'Chennai', 'Pune', 'Kolkata'];
        //     return cities[Math.floor(Math.random() * cities.length)];
        // }
        
        // Update current weather display
        function updateCurrentWeather() {
            if (!weatherData) return;
            const weatherWidget = document.querySelector('.weather-widget .weather-info');
            const tempElement = weatherWidget.querySelector('.temp');
            const conditionElements = weatherWidget.querySelectorAll('div:not(.temp)');
            tempElement.textContent = `${weatherData.main.temp}°C`;
           
            // Update weather details
            const weatherDetails = weatherWidget.children[1];
            weatherDetails.innerHTML = `
                <div>💧 ${weatherData.main.humidity}% Humidity</div>
                <div>💨 ${weatherData.wind.speed} km/h Wind</div>
            `;
            // Update weather condition
            const conditionText = weatherWidget.children[0].children[1];
            conditionText.textContent = weatherData.weather[0].description;
        }
        
        // Load live market data based on location
        async function loadLiveMarketData() {
            try {
                // Simulate location-based market data
                // In real app, integrate a market API like Agmarknet or similar
                // Example: const response = await fetch('https://api.agmarknet.gov.in/...');
                const locationBasedPrices = generateLocationBasedPrices();
                updateCurrentPrices(locationBasedPrices);
            } catch (error) {
                console.error('Market API error:', error);
            }
        }
        
        // Generate location-based market prices - Updated for Telangana
        function generateLocationBasedPrices() {
            // Telangana typical market prices
            const telanganaBasePrices = {
                tomato: 28,   // Slightly higher than national average
                wheat: 2200,  // Good wheat prices in Telangana
                onion: 20,    // Local onion prices
                rice: 3100    // Rice is major crop in Telangana
            };
            
            // Small daily variation
            const dailyFactor = 0.95 + Math.random() * 0.1; // 5% daily variation
            
            return {
                tomato: Math.round(telanganaBasePrices.tomato * dailyFactor),
                wheat: Math.round(telanganaBasePrices.wheat * dailyFactor),
                onion: Math.round(telanganaBasePrices.onion * dailyFactor),
                rice: Math.round(telanganaBasePrices.rice * dailyFactor)
            };
        }
        
        // Update current prices display
        function updateCurrentPrices(prices) {
            const priceWidget = document.querySelector('.price-widget .price-info');
            const priceElements = priceWidget.querySelectorAll('.price');
           
            if (priceElements.length >= 2) {
                priceElements[0].textContent = `₹${prices.tomato}/kg`;
                priceElements[1].textContent = `₹${prices.wheat}/qtl`;
            }
        }
        
        // Update language
        function updateLanguage() {
            const lang = document.getElementById('languageSelect').value;
            currentLanguage = lang;
           
            if (translations[lang]) {
                Object.keys(translations[lang]).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.textContent = translations[lang][key];
                    }
                });
            }
        }
        
        // Initialize speech recognition
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.lang = getLanguageCode(currentLanguage);
                recognition.interimResults = false;
                recognition.maxAlternatives = 1;
                
                recognition.onstart = function() {
                    isListening = true;
                    document.getElementById('voiceButton').classList.add('listening');
                    document.getElementById('voiceStatus').textContent = 'Listening...';
                };
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    handleVoiceInput(transcript);
                };
                
                recognition.onerror = function(event) {
                    console.log('Speech recognition error:', event.error);
                    stopListening();
                };
                
                recognition.onend = function() {
                    stopListening();
                };
            }
        }
        
        function getLanguageCode(lang) {
            const codes = {
                'en': 'en-US',
                'hi': 'hi-IN',
                'te': 'te-IN',
                'mr': 'mr-IN',
                'ta': 'ta-IN'
            };
            return codes[lang] || 'en-US';
        }
        
        function startListening() {
            if (recognition && !isListening) {
                recognition.lang = getLanguageCode(currentLanguage);
                recognition.start();
            }
        }
        
        function stopListening() {
            isListening = false;
            document.getElementById('voiceButton').classList.remove('listening');
            document.getElementById('voiceStatus').textContent = 'Say "Hi Mitra" to get started';
        }
        
        function handleVoiceInput(text) {
            addChatMessage(text, 'user');
           
            // Simulate AI response
            setTimeout(() => {
                let response = generateAIResponse(text);
                addChatMessage(response, 'ai');
                speakText(response);
            }, 1000);
        }
        
        function generateAIResponse(input) {
            const responses = {
                en: {
                    greeting: "Hello! I'm Mitra, your farming assistant for Telangana. How can I help you today?",
                    creator: "I was made by Team Codestrom from AI&ML third year students for supporting the farmers in Telangana to upgrade their farming practices.",
                    crop: `Based on Telangana's soil and weather conditions in ${weatherData ? weatherData.name : 'your area'}, I recommend planting rice or cotton this season. Current temperature ${weatherData ? weatherData.main.temp + '°C' : '28°C'} is ideal for these crops.`,
                    disease: "Please upload a photo of your plant, and I'll help identify any diseases common in Telangana and suggest treatments.",
                    weather: `Current weather in ${weatherData ? weatherData.name : 'Hyderabad'}: ${weatherData ? weatherData.main.temp + '°C, ' + weatherData.weather[0].description : '28°C, partly cloudy'}. ${weatherData && weatherData.main.humidity > 80 ? 'High humidity - watch for fungal diseases.' : 'Good conditions for most farming activities in Telangana.'}`,
                    market: `Current market prices in Telangana: Tomato ₹${generateLocationBasedPrices().tomato}/kg, Wheat ₹${generateLocationBasedPrices().wheat}/qtl, Rice ₹${generateLocationBasedPrices().rice}/qtl. These are typical Hyderabad mandi rates.`,
                    default: "I understand you're asking about farming. I can help with crops suitable for Telangana, diseases, weather, or market prices. What would you like to know?"
                },
                hi: {
                    greeting: "नमस्ते! मैं मित्रा हूँ, तेलंगाना के लिए आपका खेती सहायक। आज मैं आपकी कैसे मदद कर सकता हूँ?",
                    creator: "मैं AI&ML के तीसरे साल के छात्रों की टीम कोडेस्ट्रॉम द्वारा तेलंगाना के किसानों को अपग्रेड करने के लिए बनाया गया था।",
                    crop: `तेलंगाना की मिट्टी और मौसम की स्थिति के आधार पर, मैं इस सीजन में चावल या कपास लगाने की सलाह देता हूँ।`,
                    disease: "कृपया अपने पौधे की तस्वीर अपलोड करें, मैं तेलंगाना में आम बीमारियों की पहचान में मदद करूंगा।",
                    weather: `${weatherData ? weatherData.name : 'हैदराबाद'} में वर्तमान मौसम: ${weatherData ? weatherData.main.temp + '°C, ' + weatherData.weather[0].description : '28°C, आंशिक रूप से बादल'}।`,
                    market: `तेलंगाना में वर्तमान बाज़ार भाव: टमाटर ₹${generateLocationBasedPrices().tomato}/किलो, चावल ₹${generateLocationBasedPrices().rice}/क्विंटल।`,
                    default: "मैं समझता हूँ कि आप खेती के बारे में पूछ रहे हैं। मैं तेलंगाना के लिए उपयुक्त फसलों में सहायता कर सकता हूँ।"
                },
                te: {
                    greeting: "నమస్కారం! నేను మిత్రా, తెలంగాణ కోసం మీ వ్యవసాయ సహాయకుడిని। ఈరోజు నేను మీకు ఎలా సహాయం చేయగలను?",
                    creator: "నేను AI&ML మూడవ సంవత్సర విద్యార్థుల టీమ్ కోడేస్ట్రామ్ చేత తెలంగాణ రైతులకు వ్యవసాయ పద్ధతులను అప్‌గ్రేడ్ చేయడానికి మద్దతు ఇవ్వడానికి తయారు చేయబడ్డాను.",
                    crop: `తెలంగాణ యొక్క మట్టి మరియు వాతావరణ పరిస్థితుల ఆధారంగా, ఈ సీజన్‌లో వరి లేదా పత్తిని పండించాలని సిఫార్సు చేస్తున్నాను।`,
                    disease: "దయచేసి మీ మొక్క యొక్క ఫోటోను అప్‌లోడ్ చేయండి, తెలంగాణలో సాధారణ వ్యాధుల గుర్తింపులో సహాయం చేస్తాను।",
                    weather: `${weatherData ? weatherData.name : 'హైదరాబాద్'}లో ప్రస్తుత వాతావరణం: ${weatherData ? weatherData.main.temp + '°C, ' + weatherData.weather[0].description : '28°C, పాక్షికంగా మేఘావృతం'}।`,
                    market: `తెలంగాణలో ప్రస్తుత మార్కెట్ ధరలు: టొమాటో ₹${generateLocationBasedPrices().tomato}/కిలో, వరి ₹${generateLocationBasedPrices().rice}/క్వింటల్।`,
                    default: "మీరు వ్యవసాయం గురించి అడుగుతున్నారని నేను అర్థం చేసుకున్నాను। తెలంగాణకు అనువైన పంటలలో నేను సహాయం చేయగలను।"
                },
                mr: {
                    greeting: "नमस्कार! मी मित्रा, तेलंगणासाठी तुमचा शेती सहाय्यक. आज मी तुम्हाला कशी मदत करू शकतो?",
                    creator: "मला AI&ML तृतीय वर्षातील विद्यार्थ्यांच्या टीम कोडेस्ट्रॉमने तेलंगणातील शेतकऱ्यांना त्यांच्या शेती पद्धती अपग्रेड करण्यासाठी मदत करण्यासाठी बनवले.",
                    crop: "तेलंगणाच्या मातीच्या आणि हवामानाच्या परिस्थितीनुसार, या हंगामात तांदूळ किंवा कापूस लावण्याची शिफारस करतो.",
                    disease: "कृपया आपल्या वनस्पतीचा फोटो अपलोड करा, मी तेलंगणात सामान्य रोगांची ओळख करण्यात मदत करेल.",
                    weather: `${weatherData ? weatherData.name : 'हैदराबाद'}मध्ये सद्यस्थितीतील हवामान: ${weatherData ? weatherData.main.temp + '°C, ' + weatherData.weather[0].description : '28°C, अंशतः ढगाळ'}।`,
                    market: `तेलंगणातील सद्यस्थितीतील बाजारभाव: टोमॅटो ₹${generateLocationBasedPrices().tomato}/किलो, तांदूळ ₹${generateLocationBasedPrices().rice}/क्विंटल।`,
                    default: "तुम्ही शेतीबद्दल विचारत आहात हे मला समजते. तेलंगणासाठी योग्य पिकांमध्ये मी मदत करू शकतो।"
                },
                ta: {
                    greeting: "வணக்கம்! நான் மித்ரா, தெலுங்கானாவுக்கான உங்கள் விவசாய உதவியாளர். இன்று நான் உங்களுக்கு எப்படி உதவ முடியும்?",
                    creator: "நான் AI&ML மூன்றாம் ஆண்டு மாணவர்களின் டீம் கோடெஸ்ட்ரோம் மூலம் தெலுங்கானா விவசாயிகளின் விவசாய முறைகளை மேம்படுத்த உதவுவதற்காக உருவாக்கப்பட்டேன்.",
                    crop: "தெலுங்கானாவின் மண் மற்றும் காலநிலை நிலைமைகளின் அடிப்படையில், இந்த பருவத்தில் நெல் அல்லது பருத்தி பயிரிட பரிந்துரைக்கிறேன்.",
                    disease: "உங்கள் செடியின் புகைப்படத்தை பதிவேற்றவும், தெலுங்கானாவில் பொதுவான நோய்களை கண்டறிய உதவுகிறேன்.",
                    weather: `${weatherData ? weatherData.name : 'ஹைதராபாத்'}இல் தற்போதைய வானிலை: ${weatherData ? weatherData.main.temp + '°C, ' + weatherData.weather[0].description : '28°C, பகுதியளவு மேகமூட்டம்'}।`,
                    market: `தெலுங்கானாவில் தற்போதைய சந்தை விலைகள்: தக்காளி ₹${generateLocationBasedPrices().tomato}/கிலோ, அரிசி ₹${generateLocationBasedPrices().rice}/குவிண்டால்।`,
                    default: "நீங்கள் விவசாயத்தைப் பற்றி கேட்கிறீர்கள் என்று புரிகிறது. தெலுங்கானாவிற்கு ஏற்ற பயிர்களில் என்னால் உதவ முடியும்।"
                }
            };
            
            const lang = responses[currentLanguage] || responses.en;
            const lowerInput = input.toLowerCase();
            
            if (lowerInput.includes('who made you') || lowerInput.includes('creator') || lowerInput.includes('who created you') || lowerInput.includes('किसने बनाया') || lowerInput.includes('నిన్ను ఎవరు తయారు చేశారు')|| lowerInput.includes('तुम्हाला कोणी बनवले')) {
                return lang.creator;
            } else if (lowerInput.includes('hello') || lowerInput.includes('hi') || lowerInput.includes('नमस्ते') || lowerInput.includes('నమస్కారం') || lowerInput.includes('नमस्कार')) {
                return lang.greeting;
            } else if (lowerInput.includes('crop') || lowerInput.includes('फसल') || lowerInput.includes('పంట')) {
                return lang.crop;
            } else if (lowerInput.includes('disease') || lowerInput.includes('बीमारी') || lowerInput.includes('వ్యాధి')) {
                return lang.disease;
            } else if (lowerInput.includes('weather') || lowerInput.includes('मौसम') || lowerInput.includes('వాతావరణం')) {
                return lang.weather;
            } else if (lowerInput.includes('price') || lowerInput.includes('market') || lowerInput.includes('भाव') || lowerInput.includes('ధర')) {
                return lang.market;
            } else {
                return lang.default;
            }
        }
        
        function speakText(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = getLanguageCode(currentLanguage);
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }
        
        function addChatMessage(message, type) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = message;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function showSection(sectionName, event) {
            // Hide all sections
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => section.classList.add('hidden'));
           
            // Show selected section
            const targetSection = document.getElementById(sectionName);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            
            // Special handling for disease detection
            if (sectionName === 'disease') {
                // Reset the disease detection interface
                const diseaseResults = document.getElementById('diseaseResults');
                const messagesDiv = document.getElementById('diseaseMessages');
                diseaseResults.style.display = 'none';
                messagesDiv.innerHTML = '';
                
                // Show upload interface
                const imageUpload = document.querySelector('.image-upload');
                if (imageUpload) {
                    imageUpload.style.display = 'block';
                }
            }
            
            // Special handling for chat section (crop advice)
            if (sectionName === 'chat') {
                const chatSection = document.querySelector('#chat .chat-section');
                if (chatSection) {
                    chatSection.style.display = 'block';
                }
                // Add helpful message for crop advice
                setTimeout(() => {
                    const chatMessages = document.getElementById('chatMessages');
                    if (chatMessages.children.length <= 1) {
                        addChatMessage("Hi! I can help you with crop advice for Telangana. Ask me about suitable crops for your soil type, best planting times, or farming techniques.", 'ai');
                    }
                }, 500);
            }
            
            // Update navigation
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => item.classList.remove('active'));
            
            // Handle nav item activation properly
            if (event && event.target) {
                const navItem = event.target.closest('.nav-item');
                if (navItem) {
                    navItem.classList.add('active');
                } else {
                    // If clicked from action card, find the corresponding nav item
                    const correspondingNavItem = document.querySelector(`.nav-item[onclick*="${sectionName}"]`);
                    if (correspondingNavItem) {
                        correspondingNavItem.classList.add('active');
                    }
                }
            }
        }
        
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                // Show loading state
                const diseaseResults = document.getElementById('diseaseResults');
                const messagesDiv = document.getElementById('diseaseMessages');
                const imageUpload = document.querySelector('.image-upload');
                
                imageUpload.style.display = 'none';
                diseaseResults.style.display = 'block';
                
                // Add loading message
                const loadingMessage = document.createElement('div');
                loadingMessage.className = 'message ai';
                loadingMessage.innerHTML = `<strong>🔍 Analyzing your plant image...</strong><br>Please wait while I process the photo.`;
                messagesDiv.appendChild(loadingMessage);
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Simulate disease detection with realistic Telangana diseases
                    setTimeout(() => {
                        // Remove loading message
                        loadingMessage.remove();
                        
                        const telanganaLiseases = [
                            { name: 'Brown Leaf Spot', crop: 'Rice', confidence: 92, treatment: 'Apply Copper fungicide', prevention: 'Avoid overhead irrigation' },
                            { name: 'Pink Bollworm', crop: 'Cotton', confidence: 88, treatment: 'Use Bt cotton varieties', prevention: 'Regular field monitoring' },
                            { name: 'Early Blight', crop: 'Tomato', confidence: 85, treatment: 'Neem oil spray', prevention: 'Proper plant spacing' },
                            { name: 'Anthracnose', crop: 'Chilli', confidence: 90, treatment: 'Carbendazim spray', prevention: 'Good drainage' },
                            { name: 'Leaf Curl', crop: 'Cotton', confidence: 87, treatment: 'Remove infected leaves', prevention: 'Control whitefly vectors' }
                        ];
                        
                        const randomDisease = telanganaLiseases[Math.floor(Math.random() * telanganaLiseases.length)];
                        
                        const analysisMessage = document.createElement('div');
                        analysisMessage.className = 'message ai';
                        analysisMessage.innerHTML = `
                            <strong>🔍 Analysis Complete</strong><br>
                            <strong>Disease Detected:</strong> ${randomDisease.name}<br>
                            <strong>Affected Crop:</strong> ${randomDisease.crop}<br>
                            <strong>Confidence:</strong> ${randomDisease.confidence}%<br>
                            <strong>Treatment:</strong> ${randomDisease.treatment}<br>
                            <strong>Prevention:</strong> ${randomDisease.prevention}<br>
                            <strong>Weather Advisory:</strong> Current humidity ${weatherData ? weatherData.main.humidity + '%' : '65%'} - ${weatherData && weatherData.main.humidity > 75 ? 'Monitor closely for fungal spread' : 'Good conditions for treatment'}
                        `;
                        messagesDiv.appendChild(analysisMessage);
                    }, 3000);
                };
                reader.readAsDataURL(file);
            }
        }
        
        function resetDiseaseDetection() {
            const imageUpload = document.querySelector('.image-upload');
            const diseaseResults = document.getElementById('diseaseResults');
            const messagesDiv = document.getElementById('diseaseMessages');
            const imageInput = document.getElementById('imageInput');
            
            // Reset interface
            imageUpload.style.display = 'block';
            diseaseResults.style.display = 'none';
            messagesDiv.innerHTML = '';
            imageInput.value = '';
        }
        
        function loadWeatherForecast() {
            const forecast = document.getElementById('weatherForecast');
           
            // Show location info for Telangana
            let forecastHTML = `
                <div style="background: #E8F5E8; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
                    <strong>📍 Weather forecast for Telangana</strong><br>
                    <small>Data for ${userLocation.city}, ${userLocation.state}</small>
                </div>
            `;
            
            const days = ['Today', 'Tomorrow', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'];
            const baseTemp = weatherData ? weatherData.main.temp : 28;
            
            const telanganaConditions = [
                { condition: 'Hot & Sunny', icon: '☀️', temp: baseTemp + 2 },
                { condition: 'Partly Cloudy', icon: '⛅', temp: baseTemp - 1 },
                { condition: 'Rain Expected', icon: '🌧️', temp: baseTemp - 3, alert: true },
                { condition: 'Humid', icon: '🌤️', temp: baseTemp + 1 },
                { condition: 'Clear Sky', icon: '☀️', temp: baseTemp + 3 },
                { condition: 'Thunderstorms', icon: '⛈️', temp: baseTemp - 2, alert: true },
                { condition: 'Pleasant', icon: '🌞', temp: baseTemp }
            ];
           
            days.forEach((day, index) => {
                const dayCondition = telanganaConditions[index];
                const alertClass = dayCondition.alert ? ' rain-alert' : '';
                
                forecastHTML += `
                    <div class="forecast-card${alertClass}">
                        <div>
                            <div class="forecast-day">${day}</div>
                            <div class="forecast-condition">${dayCondition.condition}</div>
                            ${dayCondition.alert ? '<div class="forecast-alert">⚠️ Avoid pesticide spraying</div>' : ''}
                        </div>
                        <div class="forecast-weather">
                            <div class="forecast-icon">${dayCondition.icon}</div>
                            <div class="forecast-temp">${Math.round(dayCondition.temp)}°C</div>
                        </div>
                    </div>
                `;
            });
           
            forecast.innerHTML = forecastHTML;
        }
        
        function loadMarketDetails() {
            const marketDetails = document.getElementById('marketDetails');
           
            // Telangana specific crops
            const telanganaCrops = [
                { name: 'Rice (Paddy)', basePrice: 3100, unit: 'qtl', market: 'Hyderabad APMC' },
                { name: 'Cotton', basePrice: 6800, unit: 'qtl', market: 'Cotton Market' },
                { name: 'Tomato', basePrice: 28, unit: 'kg', market: 'Local Mandi' },
                { name: 'Chilli', basePrice: 85, unit: 'kg', market: 'Spice Market' },
                { name: 'Turmeric', basePrice: 120, unit: 'kg', market: 'Nizamabad Market' },
                { name: 'Maize', basePrice: 2800, unit: 'qtl', market: 'Regional Market' }
            ];
            
            let marketHTML = `
                <div style="background: #E8F5E8; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
                    <strong>📍 Market prices for Telangana</strong><br>
                    <small>Live rates from major mandis</small>
                </div>
            `;
           
            telanganaCrops.forEach(crop => {
                // Apply location-based price variation
                const locationFactor = 0.90 + Math.random() * 0.20; // 10% variation
                const currentPrice = Math.round(crop.basePrice * locationFactor);
                const trend = Math.random() > 0.5 ? 'up' : 'down';
                const trendPercent = Math.round(Math.random() * 8) + 2;
                const trendIcon = trend === 'up' ? '↗️' : '↘️';
                const trendColor = trend === 'up' ? '#4CAF50' : '#F44336';
               
                marketHTML += `
                    <div style="background: white; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 4px solid #FF9800; transition: background 0.3s ease;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <strong style="color: #2E7D32;">${crop.name}</strong>
                            <span style="font-size: 18px; font-weight: bold; color: #FF9800;">₹${currentPrice}/${crop.unit}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 12px; color: #666;">
                            <span>${crop.market}</span>
                            <span style="color: ${trendColor}">${trendIcon} ${trendPercent}%</span>
                        </div>
                        ${Math.random() > 0.6 ? `<div style="font-size: 11px; color: #FF9800; margin-top: 5px;">💡 ${trend === 'up' ? 'Good time to sell' : 'Prices may rise'}</div>` : ''}
                    </div>
                `;
            });
           
            marketDetails.innerHTML = marketHTML;
        }
        
        function startVoiceChat() {
            startListening();
        }
        
        // Event listeners
        document.getElementById('languageSelect').addEventListener('change', updateLanguage);
        document.getElementById('voiceButton').addEventListener('click', startListening);
        document.getElementById('darkModeToggle').addEventListener('click', toggleDarkMode);
        
        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
        
        // Add some sample chat messages on initialization
        setTimeout(() => {
            addChatMessage("Welcome to Mitra AI! I'm here to help Telangana farmers with crop advice, weather updates, and market prices. You can ask me anything about farming in our region.", 'ai');
        }, 1000);
        
        // TODO: Add push notifications for weather alerts (use Notification API)
        // TODO: Implement offline support with Service Workers  
        // TODO: Expand languages - add more to translations object
        // TODO: User authentication - integrate with Firebase or similar for profiles
        // TODO: Add real API integrations for weather and market data
        // TODO: Integrate actual ML model for disease detection
        // TODO: Add crop calendar specific to Telangana farming seasons
        // TODO: Include government scheme notifications for Telangana farmers
    </script>
</body>
</html>
