<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mitra AI - Your Digital Farming Companion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            min-height: 100vh;
            color: #333;
            transition: background 0.3s ease, color 0.3s ease;
        }
        body.dark-mode {
            background: linear-gradient(135deg, #1B5E20, #33691E);
            color: #EEE;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: background 0.3s ease;
        }
        body.dark-mode .container {
            background: #121212;
        }
        .header {
            background: linear-gradient(135deg, #2E7D32, #4CAF50);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            transition: background 0.3s ease;
        }
        body.dark-mode .header {
            background: linear-gradient(135deg, #1B5E20, #33691E);
        }
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
            font-weight: 600;
        }
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        .language-selector {
            position: absolute;
            top: 15px;
            right: 15px;
        }
        .language-selector select {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
        }
        .dark-mode-toggle {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
        }
        .location-selector {
            background: white;
            margin: 20px;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }
        body.dark-mode .location-selector {
            background: #1E1E1E;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        .location-selector h4 {
            color: #2E7D32;
            margin-bottom: 10px;
            font-size: 14px;
            transition: color 0.3s ease;
        }
        body.dark-mode .location-selector h4 {
            color: #81C784;
        }
        .location-selector select {
            background: white;
            border: 2px solid #E8F5E8;
            color: #333;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 14px;
            width: 100%;
            transition: border-color 0.3s ease;
        }
        body.dark-mode .location-selector select {
            background: #333;
            border-color: #555;
            color: #EEE;
        }
        .voice-section {
            padding: 30px 20px;
            text-align: center;
            background: linear-gradient(135deg, #E8F5E8, #F1F8E9);
            transition: background 0.3s ease;
        }
        body.dark-mode .voice-section {
            background: linear-gradient(135deg, #263238, #37474F);
        }
        .voice-button {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
        }
        body.dark-mode .voice-button {
            background: linear-gradient(135deg, #388E3C, #66BB6A);
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
        }
        .voice-button:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.4);
        }
        body.dark-mode .voice-button:hover {
            box-shadow: 0 10px 25px rgba(0,0,0,0.6);
        }
        .voice-button.listening {
            animation: pulse 1.5s infinite;
            background: linear-gradient(135deg, #FF5722, #FF7043);
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .voice-status {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
            transition: color 0.3s ease;
        }
        body.dark-mode .voice-status {
            color: #BBB;
        }
        .quick-actions {
            padding: 20px;
        }
        .quick-actions h3 {
            color: #2E7D32;
            margin-bottom: 15px;
            font-size: 18px;
            transition: color 0.3s ease;
        }
        body.dark-mode .quick-actions h3 {
            color: #81C784;
        }
        .action-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        .action-card {
            background: white;
            border: 2px solid #E8F5E8;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        body.dark-mode .action-card {
            background: #1E1E1E;
            border-color: #333;
            box-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }
        .action-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.2);
            border-color: #4CAF50;
        }
        body.dark-mode .action-card:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.6);
            border-color: #81C784;
        }
        .action-card .icon {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }
        .action-card h4 {
            color: #2E7D32;
            font-size: 14px;
            margin-bottom: 5px;
            transition: color 0.3s ease;
        }
        body.dark-mode .action-card h4 {
            color: #81C784;
        }
        .action-card p {
            color: #666;
            font-size: 12px;
            line-height: 1.3;
            transition: color 0.3s ease;
        }
        body.dark-mode .action-card p {
            color: #BBB;
        }
        .chat-section {
            padding: 20px;
            background: #f9f9f9;
            display: none;
            transition: background 0.3s ease;
        }
        body.dark-mode .chat-section {
            background: #1E1E1E;
        }
        .chat-messages {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        .message {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: background 0.3s ease;
        }
        body.dark-mode .message {
            background: #333;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        .message.ai {
            background: linear-gradient(135deg, #E8F5E8, #F1F8E9);
            border-left: 4px solid #4CAF50;
            transition: background 0.3s ease, border-color 0.3s ease;
        }
        body.dark-mode .message.ai {
            background: linear-gradient(135deg, #263238, #37474F);
            border-left-color: #81C784;
        }
        .message.user {
            background: #2196F3;
            color: white;
            margin-left: 20px;
        }
        body.dark-mode .message.user {
            background: #1976D2;
        }
        .image-upload {
            padding: 20px;
            background: #f5f5f5;
            text-align: center;
            display: none;
            transition: background 0.3s ease;
        }
        body.dark-mode .image-upload {
            background: #1E1E1E;
        }
        .upload-area {
            border: 2px dashed #4CAF50;
            border-radius: 12px;
            padding: 40px 20px;
            cursor: pointer;
            transition: all 0.3s ease, border-color 0.3s ease;
        }
        body.dark-mode .upload-area {
            border-color: #81C784;
        }
        .upload-area:hover {
            background: #E8F5E8;
        }
        body.dark-mode .upload-area:hover {
            background: #263238;
        }
        .upload-area input {
            display: none;
        }
        .weather-widget, .price-widget {
            background: white;
            margin: 20px;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }
        body.dark-mode .weather-widget, body.dark-mode .price-widget {
            background: #1E1E1E;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        .weather-widget h3, .price-widget h3 {
            color: #2E7D32;
            margin-bottom: 10px;
            font-size: 16px;
            transition: color 0.3s ease;
        }
        body.dark-mode .weather-widget h3, body.dark-mode .price-widget h3 {
            color: #81C784;
        }
        .weather-info, .price-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .temp {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
            transition: color 0.3s ease;
        }
        body.dark-mode .temp {
            color: #81C784;
        }
        .price {
            font-size: 18px;
            font-weight: bold;
            color: #FF9800;
            transition: color 0.3s ease;
        }
        body.dark-mode .price {
            color: #FFB74D;
        }
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 400px;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }
        body.dark-mode .bottom-nav {
            background: #121212;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.5);
        }
        .nav-item {
            text-align: center;
            cursor: pointer;
            padding: 5px;
            border-radius: 8px;
            transition: all 0.3s ease;
            flex: 1;
        }
        .nav-item:hover {
            background: #E8F5E8;
        }
        body.dark-mode .nav-item:hover {
            background: #263238;
        }
        .nav-item.active {
            background: #4CAF50;
            color: white;
        }
        body.dark-mode .nav-item.active {
            background: #388E3C;
        }
        .nav-item .icon {
            font-size: 20px;
            margin-bottom: 2px;
        }
        .nav-item .label {
            font-size: 10px;
        }
        .hidden {
            display: none;
        }
        .visible {
            display: block;
        }
        @media (max-width: 400px) {
            .container {
                max-width: 100%;
            }
            .bottom-nav {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="dark-mode-toggle" id="darkModeToggle">🌙 Dark Mode</button>
            <div class="language-selector">
                <select id="languageSelect">
                    <option value="en">English</option>
                    <option value="hi">हिंदी</option>
                    <option value="te">తెలుగు</option>
                    <option value="mr">मराठी</option>
                    <option value="ta">தமிழ்</option>
                </select>
            </div>
            <h1>🌾 Mitra AI</h1>
            <p id="headerSubtitle">Your Digital Farming Companion</p>
            <p style="font-size: 12px; opacity: 0.8; margin-top: 5px;">by Team CodeStrom</p>
        </div>
        <!-- Main Dashboard -->
        <div id="dashboard" class="section">
            <div class="voice-section">
                <button class="voice-button" id="voiceButton">
                    🎤<br>Tap to Speak
                </button>
                <div class="voice-status" id="voiceStatus">Say "Hi Mitra" to get started</div>
            </div>
            <div class="quick-actions">
                <h3 id="quickActionsTitle">Quick Actions</h3>
                <div class="action-grid">
                    <div class="action-card" onclick="showSection('chat', event)">
                        <span class="icon">🌱</span>
                        <h4 id="cropAdviceTitle">Crop Advice</h4>
                        <p id="cropAdviceDesc">Get personalized crop recommendations</p>
                    </div>
                    <div class="action-card" onclick="showSection('disease', event)">
                        <span class="icon">🔍</span>
                        <h4 id="diseaseDetectionTitle">Disease Detection</h4>
                        <p id="diseaseDetectionDesc">Upload plant photos for diagnosis</p>
                    </div>
                    <div class="action-card" onclick="showSection('weather', event)">
                        <span class="icon">🌤️</span>
                        <h4 id="weatherTitle">Weather</h4>
                        <p id="weatherDesc">Local weather forecasts & alerts</p>
                    </div>
                    <div class="action-card" onclick="showSection('market', event)">
                        <span class="icon">💰</span>
                        <h4 id="marketTitle">Market Prices</h4>
                        <p id="marketDesc">Real-time mandi prices</p>
                    </div>
                </div>
            </div>
            <div class="weather-widget">
                <h3 id="currentWeatherTitle">Today's Weather</h3>
                <div class="weather-info">
                    <div>
                        <div class="temp">28°C</div>
                        <div>Partly Cloudy</div>
                    </div>
                    <div>
                        <div>💧 65% Humidity</div>
                        <div>💨 12 km/h Wind</div>
                    </div>
                </div>
            </div>
            <div class="price-widget">
                <h3 id="marketPricesTitle">Market Prices</h3>
                <div class="price-info">
                    <div>
                        <div>🍅 Tomato</div>
                        <div>🌾 Wheat</div>
                    </div>
                    <div>
                        <div class="price">₹25/kg</div>
                        <div class="price">₹2100/qtl</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Disease Detection Section -->
        <div id="disease" class="section hidden">
            <div class="image-upload">
                <h3 id="diseaseUploadTitle">Plant Disease Detection</h3>
                <div class="upload-area" onclick="document.getElementById('imageInput').click()">
                    <input type="file" id="imageInput" accept="image/*" onchange="handleImageUpload(event)">
                    <div>📷</div>
                    <p id="uploadInstruction">Tap to upload plant photo</p>
                </div>
            </div>
            <div class="chat-section" id="diseaseResults" style="display:none;">
                <div class="chat-messages" id="diseaseMessages"></div>
            </div>
        </div>
        <!-- Chat Section -->
        <div id="chat" class="section hidden">
            <div class="chat-section" style="display:block;">
                <h3 id="chatTitle">Chat with Mitra</h3>
                <div class="chat-messages" id="chatMessages"></div>
                <button class="voice-button" style="width:60px; height:60px; font-size:14px;" onclick="startVoiceChat()">
                    🎤
                </button>
            </div>
        </div>
        <!-- Weather Section -->
        <div id="weather" class="section hidden">
            <div class="location-selector">
                <h4>📍 Select Your District</h4>
                <select id="districtSelect">
                    <option value="hyderabad">Hyderabad</option>
                    <option value="warangal">Warangal</option>
                    <option value="nizamabad">Nizamabad</option>
                    <option value="karimnagar">Karimnagar</option>
                    <option value="khammam">Khammam</option>
                    <option value="nalgonda">Nalgonda</option>
                    <option value="medak">Medak</option>
                    <option value="rangareddy">Rangareddy</option>
                    <option value="mahabubnagar">Mahabubnagar</option>
                    <option value="adilabad">Adilabad</option>
                </select>
            </div>
            <div style="padding: 20px;">
                <h3 id="weatherForecastTitle">7-Day Weather Forecast</h3>
                <div id="weatherForecast"></div>
            </div>
        </div>
        <!-- Market Section -->
        <div id="market" class="section hidden">
            <div style="padding: 20px;">
                <h3 id="marketDetailsTitle">Market Information</h3>
                <div id="marketDetails"></div>
            </div>
        </div>
        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="showSection('dashboard', event)">
                <div class="icon">🏠</div>
                <div class="label" id="homeLabel">Home</div>
            </div>
            <div class="nav-item" onclick="showSection('chat', event)">
                <div class="icon">💬</div>
                <div class="label" id="chatLabel">Chat</div>
            </div>
            <div class="nav-item" onclick="showSection('weather', event)">
                <div class="icon">🌤️</div>
                <div class="label" id="weatherLabel">Weather</div>
            </div>
            <div class="nav-item" onclick="showSection('market', event)">
                <div class="icon">💰</div>
                <div class="label" id="marketLabel">Market</div>
            </div>
        </div>
    </div>
    <script>
        let currentLanguage = 'en';
        let isListening = false;
        let recognition;
        let userLocation = null;
        let weatherData = null;
        let isDarkMode = false;
        let currentDistrict = 'hyderabad';

        // Telangana districts data with coordinates
        const telanganaDistricts = {
            hyderabad: { name: 'Hyderabad', lat: 17.3850, lng: 78.4867 },
            warangal: { name: 'Warangal', lat: 17.9669, lng: 79.5941 },
            nizamabad: { name: 'Nizamabad', lat: 18.6725, lng: 78.0941 },
            karimnagar: { name: 'Karimnagar', lat: 18.4386, lng: 79.1288 },
            khammam: { name: 'Khammam', lat: 17.2473, lng: 80.1514 },
            nalgonda: { name: 'Nalgonda', lat: 17.0542, lng: 79.2673 },
            medak: { name: 'Medak', lat: 18.0476, lng: 78.2747 },
            rangareddy: { name: 'Rangareddy', lat: 17.4065, lng: 78.4772 },
            mahabubnagar: { name: 'Mahabubnagar', lat: 16.7430, lng: 78.0026 },
            adilabad: { name: 'Adilabad', lat: 19.6700, lng: 78.5353 }
        };

        // Language translations
        const translations = {
            en: {
                headerSubtitle: "Your Digital Farming Companion",
                quickActionsTitle: "Quick Actions",
                cropAdviceTitle: "Crop Advice",
                cropAdviceDesc: "Get personalized crop recommendations",
                diseaseDetectionTitle: "Disease Detection",
                diseaseDetectionDesc: "Upload plant photos for diagnosis",
                weatherTitle: "Weather",
                weatherDesc: "Local weather forecasts & alerts",
                marketTitle: "Market Prices",
                marketDesc: "Real-time mandi prices",
                currentWeatherTitle: "Today's Weather",
                marketPricesTitle: "Market Prices",
                diseaseUploadTitle: "Plant Disease Detection",
                uploadInstruction: "Tap to upload plant photo",
                chatTitle: "Chat with Mitra",
                weatherForecastTitle: "7-Day Weather Forecast",
                marketDetailsTitle: "Market Information",
                homeLabel: "Home",
                chatLabel: "Chat",
                weatherLabel: "Weather",
                marketLabel: "Market"
            },
            hi: {
                headerSubtitle: "आपका डिजिटल खेती साथी",
                quickActionsTitle: "त्वरित कार्य",
                cropAdviceTitle: "फसल सलाह",
                cropAdviceDesc: "व्यक्तिगत फसल सुझाव प्राप्त करें",
                diseaseDetectionTitle: "रोग पहचान",
                diseaseDetectionDesc: "निदान के लिए पौधों की तस्वीरें अपलोड करें",
                weatherTitle: "मौसम",
                weatherDesc: "स्थानीय मौसम पूर्वानुमान और अलर्ट",
                marketTitle: "बाज़ार भाव",
                marketDesc: "वास्तविक समय मंडी मूल्य",
                currentWeatherTitle: "आज का मौसम",
                marketPricesTitle: "बाज़ार भाव",
                diseaseUploadTitle: "पौधे की बीमारी की पहचान",
                uploadInstruction: "पौधे की तस्वीर अपलोड करने के लिए टैप करें",
                chatTitle: "मित्रा से बात करें",
                weatherForecastTitle: "7-दिन मौसम पूर्वानुमान",
                marketDetailsTitle: "बाज़ार जानकारी",
                homeLabel: "होम",
                chatLabel: "चैट",
                weatherLabel: "मौसम",
                marketLabel: "मार्केट"
            },
            te: {
                headerSubtitle: "మీ డిజిటల్ వ్యవసాయ సహాయకుడు",
                quickActionsTitle: "త్వరిత చర్యలు",
                cropAdviceTitle: "పంట సలహా",
                cropAdviceDesc: "వ్యక్తిగతీకరించిన పంట సిఫార్సులు పొందండి",
                diseaseDetectionTitle: "వ్యాధి గుర్తింపు",
                diseaseDetectionDesc: "నిర్ధారణ కోసం మొక్కల ఫోటోలను అప్‌లోడ్ చేయండి",
                weatherTitle: "వాతావరణం",
                weatherDesc: "స్థానీయ వాతావరణ అంచనాలు & హెచ్చరికలు",
                marketTitle: "మార్కెట్ ధరలు",
                marketDesc: "రియల్ టైమ్ మండి ధరలు",
                currentWeatherTitle: "నేటి వాతావరణం",
                marketPricesTitle: "మార్కెట్ ధరలు",
                diseaseUploadTitle: "మొక్కల వ్యాధి గుర్తింపు",
                uploadInstruction: "మొక్కల ఫోటో అప్‌లోడ్ చేయడానికి ట్యాప్ చేయండి",
                chatTitle: "మిత్రాతో చాట్ చేయండి",
                weatherForecastTitle: "7-రోజుల వాతావరణ అంచనా",
                marketDetailsTitle: "మార్కెట్ సమాచారం",
                homeLabel: "హోమ్",
                chatLabel: "చాట్",
                weatherLabel: "వాతావరణం",
                marketLabel: "మార్కెట్"
            }
        };

        // Initialize app
        function initApp() {
            updateLanguage();
            initSpeechRecognition();
            initLocationHandling();
            loadWeatherForecast();
            loadMarketDetails();
            toggleDarkMode(); // Initialize dark mode state
        }

        // Initialize location handling
        function initLocationHandling() {
            // Set default location to Hyderabad
            currentDistrict = document.getElementById('districtSelect').value;
            userLocation = telanganaDistricts[currentDistrict];
            
            document.getElementById('voiceStatus').textContent = `Loading data for ${userLocation.name}...`;
            
            // Try to get user's actual location first
            getUserLocation();
            
            // Add event listener for district changes
            document.getElementById('districtSelect').addEventListener('change', handleDistrictChange);
        }

        // Handle district change
        function handleDistrictChange(event) {
            currentDistrict = event.target.value;
            userLocation = telanganaDistricts[currentDistrict];
            
            document.getElementById('voiceStatus').textContent = `Switching to ${userLocation.name}...`;
            
            loadWeatherDataForDistrict();
            loadMarketDataForDistrict();
            
            setTimeout(() => {
                document.getElementById('voiceStatus').textContent = `Data updated for ${userLocation.name}`;
                setTimeout(() => {
                    document.getElementById('voiceStatus').textContent = 'Say "Hi Mitra" to get started';
                }, 2000);
            }, 1000);
        }

        // Toggle dark mode
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            const toggleButton = document.getElementById('darkModeToggle');
            toggleButton.textContent = isDarkMode ? '☀️ Light Mode' : '🌙 Dark Mode';
        }

        // Get user's current location (with fallback to selected district)
        function getUserLocation() {
            if ("geolocation" in navigator) {
                document.getElementById('voiceStatus').textContent = 'Trying to get your exact location...';
                
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const actualLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        
                        // Check if user is in Telangana (approximate bounds)
                        if (isLocationInTelangana(actualLocation)) {
                            // Find nearest district
                            const nearestDistrict = findNearestDistrict(actualLocation);
                            currentDistrict = nearestDistrict;
                            userLocation = telanganaDistricts[nearestDistrict];
                            
                            // Update dropdown
                            document.getElementById('districtSelect').value = nearestDistrict;
                            
                            document.getElementById('voiceStatus').textContent = `Using your location: ${userLocation.name}`;
                        } else {
                            document.getElementById('voiceStatus').textContent = `Using default district: ${userLocation.name}`;
                        }
                